var PageSupportBot=function(t){"use strict";function e(){}function n(t){return t()}function r(){return Object.create(null)}function o(t){t.forEach(n)}function s(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(t,e){t.appendChild(e)}function u(t,e,n){t.insertBefore(e,n||null)}function l(t){t.parentNode.removeChild(t)}function c(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function h(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function f(t){return document.createTextNode(t)}function d(){return f(" ")}function g(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function m(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function v(t,e){t.value=null==e?"":e}function w(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}t.selectedIndex=-1}function x(t,e,n){t.classList[n?"add":"remove"](e)}let b;function E(t){b=t}function k(){if(!b)throw new Error("Function called outside component initialization");return b}function A(){const t=k();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const o=function(t,e,n=!1){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,!1,e),r}(e,n);r.slice().forEach((e=>{e.call(t,o)}))}}}const O=[],M=[],C=[],S=[],T=Promise.resolve();let $=!1;function R(){$||($=!0,T.then(_))}function I(){return R(),T}function F(t){C.push(t)}let j=!1;const N=new Set;function _(){if(!j){j=!0;do{for(let t=0;t<O.length;t+=1){const e=O[t];E(e),P(e.$$)}for(E(null),O.length=0;M.length;)M.pop()();for(let t=0;t<C.length;t+=1){const e=C[t];N.has(e)||(N.add(e),e())}C.length=0}while(O.length);for(;S.length;)S.pop()();$=!1,j=!1,N.clear()}}function P(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(F)}}const L=new Set;let B;function q(){B={r:0,c:[],p:B}}function V(){B.r||o(B.c),B=B.p}function z(t,e){t&&t.i&&(L.delete(t),t.i(e))}function U(t,e,n,r){if(t&&t.o){if(L.has(t))return;L.add(t),B.c.push((()=>{L.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function H(t,e,r,i){const{fragment:a,on_mount:u,on_destroy:l,after_update:c}=t.$$;a&&a.m(e,r),i||F((()=>{const e=u.map(n).filter(s);l?l.push(...e):o(e),t.$$.on_mount=[]})),c.forEach(F)}function K(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function D(t,n,s,i,a,u,c,p=[-1]){const h=b;E(t);const f=t.$$={fragment:null,ctx:null,props:u,update:e,not_equal:a,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(h?h.$$.context:[])),callbacks:r(),dirty:p,skip_bound:!1,root:n.target||h.$$.root};c&&c(f.root);let d=!1;if(f.ctx=s?s(t,n.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return f.ctx&&a(f.ctx[e],f.ctx[e]=o)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](o),d&&function(t,e){-1===t.$$.dirty[0]&&(O.push(t),R(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),n})):[],f.update(),d=!0,o(f.before_update),f.fragment=!!i&&i(f.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);f.fragment&&f.fragment.l(t),t.forEach(l)}else f.fragment&&f.fragment.c();n.intro&&z(t.$$.fragment),H(t,n.target,n.anchor,n.customElement),_()}E(h)}class G{$destroy(){K(this,1),this.$destroy=e}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const J="1.0.0";function W(t,e,n,r){if(void 0===t||void 0===e||void 0===n||void 0===r)throw new X(`getBotConfig() in state.js called with missing argument. newConfig=${t}; waitForStartNewConversation= ${r}, getConfigFromRemote=${e}; localStorageKey=${n}`);if(t)botJSON=Q("TBD",n);else{let t=localStorage.getItem(n);if(!e||t||r||(t=Q("TBD",n)),t){const e=Object.freeze(JSON.parse(t));if(Y(e.version))return e}else if(!r)throw new X("getBotConfig() in state.js failed to acquire a botConfig from localStorage and remote and waitForStartNewConversation prop was false")}}function X(t){this.name="botConfig acquisition error",this.message=t,this.stack=(new Error).stack}function Y(t){if(J[0]===t[0])return!0;throw new X(`botConfig version 1.0.0 or 1.0.0 doesn't match the version of the configuration file the bot read: ${t}.`)}async function Q(t,e){try{const n=await fetch(t),r=await n.json();return localStorage.setItem(e,r),r}catch(t){console.log(t)}}function Z(t){return t+"conversation"}function tt(t){try{return JSON.parse(sessionStorage.getItem(Z(t)))}catch(t){return console.log(`error ${t} getting sessionStorage in getConversation()`),null}}function et(t,e){sessionStorage.setItem(Z(e),JSON.stringify(t))}X.prototype=new Error;var nt="INUMBER",rt="IOP1",ot="IOP2",st="IOP3",it="IVAR",at="IVARNAME",ut="IFUNCALL",lt="IFUNDEF",ct="IEXPR",pt="IEXPREVAL",ht="IMEMBER",ft="IENDSTATEMENT",dt="IARRAY";function gt(t,e){this.type=t,this.value=null!=e?e:0}function yt(t){return new gt(rt,t)}function mt(t){return new gt(ot,t)}function vt(t){return new gt(st,t)}function wt(t,e,n,r,o){for(var s,i,a,u,l=[],c=[],p=0;p<t.length;p++){var h=t[p],f=h.type;if(f===nt||f===at)Array.isArray(h.value)?l.push.apply(l,wt(h.value.map((function(t){return new gt(nt,t)})).concat(new gt(dt,h.value.length)),e,n,r,o)):l.push(h);else if(f===it&&o.hasOwnProperty(h.value))h=new gt(nt,o[h.value]),l.push(h);else if(f===ot&&l.length>1)i=l.pop(),s=l.pop(),u=n[h.value],h=new gt(nt,u(s.value,i.value)),l.push(h);else if(f===st&&l.length>2)a=l.pop(),i=l.pop(),s=l.pop(),"?"===h.value?l.push(s.value?i.value:a.value):(u=r[h.value],h=new gt(nt,u(s.value,i.value,a.value)),l.push(h));else if(f===rt&&l.length>0)s=l.pop(),u=e[h.value],h=new gt(nt,u(s.value)),l.push(h);else if(f===ct){for(;l.length>0;)c.push(l.shift());c.push(new gt(ct,wt(h.value,e,n,r,o)))}else if(f===ht&&l.length>0)s=l.pop(),l.push(new gt(nt,s.value[h.value]));else{for(;l.length>0;)c.push(l.shift());c.push(h)}}for(;l.length>0;)c.push(l.shift());return c}function xt(t,e,n){for(var r=[],o=0;o<t.length;o++){var s=t[o],i=s.type;if(i===it&&s.value===e)for(var a=0;a<n.tokens.length;a++){var u,l=n.tokens[a];u=l.type===rt?yt(l.value):l.type===ot?mt(l.value):l.type===st?vt(l.value):new gt(l.type,l.value),r.push(u)}else i===ct?r.push(new gt(ct,xt(s.value,e,n))):r.push(s)}return r}function bt(t,e,n){var r,o,s,i,a,u,l=[];if(kt(t))return At(t,n);for(var c=t.length,p=0;p<c;p++){var h=t[p],f=h.type;if(f===nt||f===at)l.push(h.value);else if(f===ot)o=l.pop(),r=l.pop(),"and"===h.value?l.push(!!r&&!!bt(o,e,n)):"or"===h.value?l.push(!!r||!!bt(o,e,n)):"="===h.value?(i=e.binaryOps[h.value],l.push(i(r,bt(o,e,n),n))):(i=e.binaryOps[h.value],l.push(i(At(r,n),At(o,n))));else if(f===st)s=l.pop(),o=l.pop(),r=l.pop(),"?"===h.value?l.push(bt(r?o:s,e,n)):(i=e.ternaryOps[h.value],l.push(i(At(r,n),At(o,n),At(s,n))));else if(f===it)if(h.value in e.functions)l.push(e.functions[h.value]);else if(h.value in e.unaryOps&&e.parser.isOperatorEnabled(h.value))l.push(e.unaryOps[h.value]);else{var d=n[h.value];if(void 0===d)throw new Error("undefined variable: "+h.value);l.push(d)}else if(f===rt)r=l.pop(),i=e.unaryOps[h.value],l.push(i(At(r,n)));else if(f===ut){for(u=h.value,a=[];u-- >0;)a.unshift(At(l.pop(),n));if(!(i=l.pop()).apply||!i.call)throw new Error(i+" is not a function");l.push(i.apply(void 0,a))}else if(f===lt)l.push(function(){for(var t=l.pop(),r=[],o=h.value;o-- >0;)r.unshift(l.pop());var s=l.pop(),i=function(){for(var o=Object.assign({},n),s=0,i=r.length;s<i;s++)o[r[s]]=arguments[s];return bt(t,e,o)};return Object.defineProperty(i,"name",{value:s,writable:!1}),n[s]=i,i}());else if(f===ct)l.push(Et(h,e));else if(f===pt)l.push(h);else if(f===ht)r=l.pop(),l.push(r[h.value]);else if(f===ft)l.pop();else{if(f!==dt)throw new Error("invalid Expression");for(u=h.value,a=[];u-- >0;)a.unshift(l.pop());l.push(a)}}if(l.length>1)throw new Error("invalid Expression (parity)");return 0===l[0]?0:At(l[0],n)}function Et(t,e,n){return kt(t)?t:{type:pt,value:function(n){return bt(t.value,e,n)}}}function kt(t){return t&&t.type===pt}function At(t,e){return kt(t)?t.value(e):t}function Ot(t,e){for(var n,r,o,s,i,a,u=[],l=0;l<t.length;l++){var c=t[l],p=c.type;if(p===nt)"number"==typeof c.value&&c.value<0?u.push("("+c.value+")"):Array.isArray(c.value)?u.push("["+c.value.map(Mt).join(", ")+"]"):u.push(Mt(c.value));else if(p===ot)r=u.pop(),n=u.pop(),s=c.value,e?"^"===s?u.push("Math.pow("+n+", "+r+")"):"and"===s?u.push("(!!"+n+" && !!"+r+")"):"or"===s?u.push("(!!"+n+" || !!"+r+")"):"||"===s?u.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+n+"),("+r+")))"):"=="===s?u.push("("+n+" === "+r+")"):"!="===s?u.push("("+n+" !== "+r+")"):"["===s?u.push(n+"[("+r+") | 0]"):u.push("("+n+" "+s+" "+r+")"):"["===s?u.push(n+"["+r+"]"):u.push("("+n+" "+s+" "+r+")");else if(p===st){if(o=u.pop(),r=u.pop(),n=u.pop(),"?"!==(s=c.value))throw new Error("invalid Expression");u.push("("+n+" ? "+r+" : "+o+")")}else if(p===it||p===at)u.push(c.value);else if(p===rt)n=u.pop(),"-"===(s=c.value)||"+"===s?u.push("("+s+n+")"):e?"not"===s?u.push("(!"+n+")"):"!"===s?u.push("fac("+n+")"):u.push(s+"("+n+")"):"!"===s?u.push("("+n+"!)"):u.push("("+s+" "+n+")");else if(p===ut){for(a=c.value,i=[];a-- >0;)i.unshift(u.pop());s=u.pop(),u.push(s+"("+i.join(", ")+")")}else if(p===lt){for(r=u.pop(),a=c.value,i=[];a-- >0;)i.unshift(u.pop());n=u.pop(),e?u.push("("+n+" = function("+i.join(", ")+") { return "+r+" })"):u.push("("+n+"("+i.join(", ")+") = "+r+")")}else if(p===ht)n=u.pop(),u.push(n+"."+c.value);else if(p===dt){for(a=c.value,i=[];a-- >0;)i.unshift(u.pop());u.push("["+i.join(", ")+"]")}else if(p===ct)u.push("("+Ot(c.value,e)+")");else if(p!==ft)throw new Error("invalid Expression")}return u.length>1&&(u=e?[u.join(",")]:[u.join(";")]),String(u[0])}function Mt(t){return"string"==typeof t?JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):t}function Ct(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1}function St(t,e,n){for(var r=!!(n=n||{}).withMembers,o=null,s=0;s<t.length;s++){var i=t[s];i.type===it||i.type===at?r||Ct(e,i.value)?null!==o?(Ct(e,o)||e.push(o),o=i.value):o=i.value:e.push(i.value):i.type===ht&&r&&null!==o?o+="."+i.value:i.type===ct?St(i.value,e,n):null!==o&&(Ct(e,o)||e.push(o),o=null)}null===o||Ct(e,o)||e.push(o)}function Tt(t,e){this.tokens=t,this.parser=e,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.functions=e.functions}gt.prototype.toString=function(){switch(this.type){case nt:case rt:case ot:case st:case it:case at:case ft:return this.value;case ut:return"CALL "+this.value;case lt:return"DEF "+this.value;case dt:return"ARRAY "+this.value;case ht:return"."+this.value;default:return"Invalid Instruction"}},Tt.prototype.simplify=function(t){return t=t||{},new Tt(wt(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,t),this.parser)},Tt.prototype.substitute=function(t,e){return e instanceof Tt||(e=this.parser.parse(String(e))),new Tt(xt(this.tokens,t,e),this.parser)},Tt.prototype.evaluate=function(t){return t=t||{},bt(this.tokens,this,t)},Tt.prototype.toString=function(){return Ot(this.tokens,!1)},Tt.prototype.symbols=function(t){t=t||{};var e=[];return St(this.tokens,e,t),e},Tt.prototype.variables=function(t){t=t||{};var e=[];St(this.tokens,e,t);var n=this.functions;return e.filter((function(t){return!(t in n)}))},Tt.prototype.toJSFunction=function(t,e){var n=this,r=new Function(t,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+Ot(this.simplify(e).tokens,!0)+"; }");return function(){return r.apply(n,arguments)}};var $t="TEOF",Rt="TOP",It="TNUMBER",Ft="TSTRING",jt="TPAREN",Nt="TBRACKET",_t="TCOMMA",Pt="TNAME",Lt="TSEMICOLON";function Bt(t,e,n){this.type=t,this.value=e,this.index=n}function qt(t,e){this.pos=0,this.current=null,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.consts=t.consts,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.options=t.options,this.parser=t}Bt.prototype.toString=function(){return this.type+": "+this.value},qt.prototype.newToken=function(t,e,n){return new Bt(t,e,null!=n?n:this.pos)},qt.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},qt.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},qt.prototype.next=function(){return this.pos>=this.expression.length?this.newToken($t,"EOF"):this.isWhitespace()||this.isComment()?this.next():this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},qt.prototype.isString=function(){var t=!1,e=this.pos,n=this.expression.charAt(e);if("'"===n||'"'===n)for(var r=this.expression.indexOf(n,e+1);r>=0&&this.pos<this.expression.length;){if(this.pos=r+1,"\\"!==this.expression.charAt(r-1)){var o=this.expression.substring(e+1,r);this.current=this.newToken(Ft,this.unescape(o),e),t=!0;break}r=this.expression.indexOf(n,r+1)}return t},qt.prototype.isParen=function(){var t=this.expression.charAt(this.pos);return("("===t||")"===t)&&(this.current=this.newToken(jt,t),this.pos++,!0)},qt.prototype.isBracket=function(){var t=this.expression.charAt(this.pos);return!("["!==t&&"]"!==t||!this.isOperatorEnabled("["))&&(this.current=this.newToken(Nt,t),this.pos++,!0)},qt.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken(_t,","),this.pos++,!0)},qt.prototype.isSemicolon=function(){return";"===this.expression.charAt(this.pos)&&(this.current=this.newToken(Lt,";"),this.pos++,!0)},qt.prototype.isConst=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var n=this.expression.charAt(e);if(n.toUpperCase()===n.toLowerCase()&&(e===this.pos||"_"!==n&&"."!==n&&(n<"0"||n>"9")))break}if(e>t){var r=this.expression.substring(t,e);if(r in this.consts)return this.current=this.newToken(It,this.consts[r]),this.pos+=r.length,!0}return!1},qt.prototype.isNamedOp=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var n=this.expression.charAt(e);if(n.toUpperCase()===n.toLowerCase()&&(e===this.pos||"_"!==n&&(n<"0"||n>"9")))break}if(e>t){var r=this.expression.substring(t,e);if(this.isOperatorEnabled(r)&&(r in this.binaryOps||r in this.unaryOps||r in this.ternaryOps))return this.current=this.newToken(Rt,r),this.pos+=r.length,!0}return!1},qt.prototype.isName=function(){for(var t=this.pos,e=t,n=!1;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()){if(e===this.pos&&("$"===r||"_"===r)){"_"===r&&(n=!0);continue}if(e===this.pos||!n||"_"!==r&&(r<"0"||r>"9"))break}else n=!0}if(n){var o=this.expression.substring(t,e);return this.current=this.newToken(Pt,o),this.pos+=o.length,!0}return!1},qt.prototype.isWhitespace=function(){for(var t=!1,e=this.expression.charAt(this.pos);!(" "!==e&&"\t"!==e&&"\n"!==e&&"\r"!==e||(t=!0,this.pos++,this.pos>=this.expression.length));)e=this.expression.charAt(this.pos);return t};var Vt=/^[0-9a-f]{4}$/i;function zt(t,e,n){this.parser=t,this.tokens=e,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=!1!==n.allowMemberAccess}qt.prototype.unescape=function(t){var e=t.indexOf("\\");if(e<0)return t;for(var n=t.substring(0,e);e>=0;){var r=t.charAt(++e);switch(r){case"'":n+="'";break;case'"':n+='"';break;case"\\":n+="\\";break;case"/":n+="/";break;case"b":n+="\b";break;case"f":n+="\f";break;case"n":n+="\n";break;case"r":n+="\r";break;case"t":n+="\t";break;case"u":var o=t.substring(e+1,e+5);Vt.test(o)||this.parseError("Illegal escape sequence: \\u"+o),n+=String.fromCharCode(parseInt(o,16)),e+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+r+'"')}++e;var s=t.indexOf("\\",e);n+=t.substring(e,s<0?t.length:s),e=s}return n},qt.prototype.isComment=function(){return"/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)},qt.prototype.isRadixInteger=function(){var t,e,n=this.pos;if(n>=this.expression.length-2||"0"!==this.expression.charAt(n))return!1;if(++n,"x"===this.expression.charAt(n))t=16,e=/^[0-9a-f]$/i,++n;else{if("b"!==this.expression.charAt(n))return!1;t=2,e=/^[01]$/i,++n}for(var r=!1,o=n;n<this.expression.length;){var s=this.expression.charAt(n);if(!e.test(s))break;n++,r=!0}return r&&(this.current=this.newToken(It,parseInt(this.expression.substring(o,n),t)),this.pos=n),r},qt.prototype.isNumber=function(){for(var t,e=!1,n=this.pos,r=n,o=n,s=!1,i=!1;n<this.expression.length&&((t=this.expression.charAt(n))>="0"&&t<="9"||!s&&"."===t);)"."===t?s=!0:i=!0,n++,e=i;if(e&&(o=n),"e"===t||"E"===t){n++;for(var a=!0,u=!1;n<this.expression.length;){if(t=this.expression.charAt(n),!a||"+"!==t&&"-"!==t){if(!(t>="0"&&t<="9"))break;u=!0,a=!1}else a=!1;n++}u||(n=o)}return e?(this.current=this.newToken(It,parseFloat(this.expression.substring(r,n))),this.pos=n):this.pos=o,e},qt.prototype.isOperator=function(){var t=this.pos,e=this.expression.charAt(this.pos);if("+"===e||"-"===e||"*"===e||"/"===e||"%"===e||"^"===e||"?"===e||":"===e||"."===e)this.current=this.newToken(Rt,e);else if("∙"===e||"•"===e)this.current=this.newToken(Rt,"*");else if(">"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(Rt,">="),this.pos++):this.current=this.newToken(Rt,">");else if("<"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(Rt,"<="),this.pos++):this.current=this.newToken(Rt,"<");else if("|"===e){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(Rt,"||"),this.pos++}else if("="===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(Rt,"=="),this.pos++):this.current=this.newToken(Rt,e);else{if("!"!==e)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(Rt,"!="),this.pos++):this.current=this.newToken(Rt,e)}return this.pos++,!!this.isOperatorEnabled(this.current.value)||(this.pos=t,!1)},qt.prototype.isOperatorEnabled=function(t){return this.parser.isOperatorEnabled(t)},qt.prototype.getCoordinates=function(){var t,e=0,n=-1;do{e++,t=this.pos-n,n=this.expression.indexOf("\n",n+1)}while(n>=0&&n<this.pos);return{line:e,column:t}},qt.prototype.parseError=function(t){var e=this.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: "+t)},zt.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},zt.prototype.tokenMatches=function(t,e){return void 0===e||(Array.isArray(e)?Ct(e,t.value):"function"==typeof e?e(t):t.value===e)},zt.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},zt.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},zt.prototype.accept=function(t,e){return!(this.nextToken.type!==t||!this.tokenMatches(this.nextToken,e))&&(this.next(),!0)},zt.prototype.expect=function(t,e){if(!this.accept(t,e)){var n=this.tokens.getCoordinates();throw new Error("parse error ["+n.line+":"+n.column+"]: Expected "+(e||t))}},zt.prototype.parseAtom=function(t){var e=this.tokens.unaryOps;if(this.accept(Pt)||this.accept(Rt,(function(t){return t.value in e})))t.push(new gt(it,this.current.value));else if(this.accept(It))t.push(new gt(nt,this.current.value));else if(this.accept(Ft))t.push(new gt(nt,this.current.value));else if(this.accept(jt,"("))this.parseExpression(t),this.expect(jt,")");else{if(!this.accept(Nt,"["))throw new Error("unexpected "+this.nextToken);if(this.accept(Nt,"]"))t.push(new gt(dt,0));else{var n=this.parseArrayList(t);t.push(new gt(dt,n))}}},zt.prototype.parseExpression=function(t){var e=[];this.parseUntilEndStatement(t,e)||(this.parseVariableAssignmentExpression(e),this.parseUntilEndStatement(t,e)||this.pushExpression(t,e))},zt.prototype.pushExpression=function(t,e){for(var n=0,r=e.length;n<r;n++)t.push(e[n])},zt.prototype.parseUntilEndStatement=function(t,e){return!!this.accept(Lt)&&(!this.nextToken||this.nextToken.type===$t||this.nextToken.type===jt&&")"===this.nextToken.value||e.push(new gt(ft)),this.nextToken.type!==$t&&this.parseExpression(e),t.push(new gt(ct,e)),!0)},zt.prototype.parseArrayList=function(t){for(var e=0;!this.accept(Nt,"]");)for(this.parseExpression(t),++e;this.accept(_t);)this.parseExpression(t),++e;return e},zt.prototype.parseVariableAssignmentExpression=function(t){for(this.parseConditionalExpression(t);this.accept(Rt,"=");){var e=t.pop(),n=[],r=t.length-1;if(e.type!==ut){if(e.type!==it&&e.type!==ht)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(n),t.push(new gt(at,e.value)),t.push(new gt(ct,n)),t.push(mt("="))}else{if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var o=0,s=e.value+1;o<s;o++){var i=r-o;t[i].type===it&&(t[i]=new gt(at,t[i].value))}this.parseVariableAssignmentExpression(n),t.push(new gt(ct,n)),t.push(new gt(lt,e.value))}}},zt.prototype.parseConditionalExpression=function(t){for(this.parseOrExpression(t);this.accept(Rt,"?");){var e=[],n=[];this.parseConditionalExpression(e),this.expect(Rt,":"),this.parseConditionalExpression(n),t.push(new gt(ct,e)),t.push(new gt(ct,n)),t.push(vt("?"))}},zt.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(Rt,"or");){var e=[];this.parseAndExpression(e),t.push(new gt(ct,e)),t.push(mt("or"))}},zt.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(Rt,"and");){var e=[];this.parseComparison(e),t.push(new gt(ct,e)),t.push(mt("and"))}};var Ut=["==","!=","<","<=",">=",">","in"];zt.prototype.parseComparison=function(t){for(this.parseAddSub(t);this.accept(Rt,Ut);){var e=this.current;this.parseAddSub(t),t.push(mt(e.value))}};var Ht=["+","-","||"];zt.prototype.parseAddSub=function(t){for(this.parseTerm(t);this.accept(Rt,Ht);){var e=this.current;this.parseTerm(t),t.push(mt(e.value))}};var Kt=["*","/","%"];function Dt(t,e){return Number(t)+Number(e)}function Gt(t,e){return t-e}function Jt(t,e){return t*e}function Wt(t,e){return t/e}function Xt(t,e){return t%e}function Yt(t,e){return Array.isArray(t)&&Array.isArray(e)?t.concat(e):""+t+e}function Qt(t,e){return t===e}function Zt(t,e){return t!==e}function te(t,e){return t>e}function ee(t,e){return t<e}function ne(t,e){return t>=e}function re(t,e){return t<=e}function oe(t,e){return Boolean(t&&e)}function se(t,e){return Boolean(t||e)}function ie(t,e){return Ct(e,t)}function ae(t){return(Math.exp(t)-Math.exp(-t))/2}function ue(t){return(Math.exp(t)+Math.exp(-t))/2}function le(t){return t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function ce(t){return t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function pe(t){return Math.log(t+Math.sqrt(t*t-1))}function he(t){return Math.log((1+t)/(1-t))/2}function fe(t){return Math.log(t)*Math.LOG10E}function de(t){return-t}function ge(t){return!t}function ye(t){return t<0?Math.ceil(t):Math.floor(t)}function me(t){return Math.random()*(t||1)}function ve(t){return xe(t+1)}zt.prototype.parseTerm=function(t){for(this.parseFactor(t);this.accept(Rt,Kt);){var e=this.current;this.parseFactor(t),t.push(mt(e.value))}},zt.prototype.parseFactor=function(t){var e=this.tokens.unaryOps;if(this.save(),this.accept(Rt,(function(t){return t.value in e}))){if("-"!==this.current.value&&"+"!==this.current.value){if(this.nextToken.type===jt&&"("===this.nextToken.value)return this.restore(),void this.parseExponential(t);if(this.nextToken.type===Lt||this.nextToken.type===_t||this.nextToken.type===$t||this.nextToken.type===jt&&")"===this.nextToken.value)return this.restore(),void this.parseAtom(t)}var n=this.current;this.parseFactor(t),t.push(yt(n.value))}else this.parseExponential(t)},zt.prototype.parseExponential=function(t){for(this.parsePostfixExpression(t);this.accept(Rt,"^");)this.parseFactor(t),t.push(mt("^"))},zt.prototype.parsePostfixExpression=function(t){for(this.parseFunctionCall(t);this.accept(Rt,"!");)t.push(yt("!"))},zt.prototype.parseFunctionCall=function(t){var e=this.tokens.unaryOps;if(this.accept(Rt,(function(t){return t.value in e}))){var n=this.current;this.parseAtom(t),t.push(yt(n.value))}else for(this.parseMemberExpression(t);this.accept(jt,"(");)if(this.accept(jt,")"))t.push(new gt(ut,0));else{var r=this.parseArgumentList(t);t.push(new gt(ut,r))}},zt.prototype.parseArgumentList=function(t){for(var e=0;!this.accept(jt,")");)for(this.parseExpression(t),++e;this.accept(_t);)this.parseExpression(t),++e;return e},zt.prototype.parseMemberExpression=function(t){for(this.parseAtom(t);this.accept(Rt,".")||this.accept(Nt,"[");){var e=this.current;if("."===e.value){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(Pt),t.push(new gt(ht,this.current.value))}else{if("["!==e.value)throw new Error("unexpected symbol: "+e.value);if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(t),this.expect(Nt,"]"),t.push(mt("["))}}};var we=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function xe(t){var e,n;if(function(t){return isFinite(t)&&t===Math.round(t)}(t)){if(t<=0)return isFinite(t)?1/0:NaN;if(t>171)return 1/0;for(var r=t-2,o=t-1;r>1;)o*=r,r--;return 0===o&&(o=1),o}if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*xe(1-t));if(t>=171.35)return 1/0;if(t>85){var s=t*t,i=s*t,a=i*t,u=a*t;return Math.sqrt(2*Math.PI/t)*Math.pow(t/Math.E,t)*(1+1/(12*t)+1/(288*s)-139/(51840*i)-571/(2488320*a)+163879/(209018880*u)+5246819/(75246796800*u*t))}--t,n=we[0];for(var l=1;l<we.length;++l)n+=we[l]/(t+l);return e=t+4.7421875+.5,Math.sqrt(2*Math.PI)*Math.pow(e,t+.5)*Math.exp(-e)*n}function be(t){return Array.isArray(t)?t.length:String(t).length}function Ee(){for(var t=0,e=0,n=0;n<arguments.length;n++){var r,o=Math.abs(arguments[n]);e<o?(t=t*(r=e/o)*r+1,e=o):t+=o>0?(r=o/e)*r:o}return e===1/0?1/0:e*Math.sqrt(t)}function ke(t,e,n){return t?e:n}function Ae(t,e){return void 0===e||0==+e?Math.round(t):(t=+t,e=-+e,isNaN(t)||"number"!=typeof e||e%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-e:-e)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+e:e))))}function Oe(t,e,n){return n&&(n[t]=e),e}function Me(t,e){return t[0|e]}function Ce(t){return 1===arguments.length&&Array.isArray(t)?Math.max.apply(Math,t):Math.max.apply(Math,arguments)}function Se(t){return 1===arguments.length&&Array.isArray(t)?Math.min.apply(Math,t):Math.min.apply(Math,arguments)}function Te(t,e){if("function"!=typeof t)throw new Error("First argument to map is not a function");if(!Array.isArray(e))throw new Error("Second argument to map is not an array");return e.map((function(e,n){return t(e,n)}))}function $e(t,e,n){if("function"!=typeof t)throw new Error("First argument to fold is not a function");if(!Array.isArray(n))throw new Error("Second argument to fold is not an array");return n.reduce((function(e,n,r){return t(e,n,r)}),e)}function Re(t,e){if("function"!=typeof t)throw new Error("First argument to filter is not a function");if(!Array.isArray(e))throw new Error("Second argument to filter is not an array");return e.filter((function(e,n){return t(e,n)}))}function Ie(t,e){if(!Array.isArray(e)&&"string"!=typeof e)throw new Error("Second argument to indexOf is not a string or array");return e.indexOf(t)}function Fe(t,e){if(!Array.isArray(e))throw new Error("Second argument to join is not an array");return e.join(t)}function je(t){return(t>0)-(t<0)||+t}var Ne=1/3;function _e(t){return t<0?-Math.pow(-t,Ne):Math.pow(t,Ne)}function Pe(t){return Math.exp(t)-1}function Le(t){return Math.log(1+t)}function Be(t){return Math.log(t)/Math.LN2}function qe(t){this.options=t||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||ae,cosh:Math.cosh||ue,tanh:Math.tanh||le,asinh:Math.asinh||ce,acosh:Math.acosh||pe,atanh:Math.atanh||he,sqrt:Math.sqrt,cbrt:Math.cbrt||_e,log:Math.log,log2:Math.log2||Be,ln:Math.log,lg:Math.log10||fe,log10:Math.log10||fe,expm1:Math.expm1||Pe,log1p:Math.log1p||Le,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||ye,"-":de,"+":Number,exp:Math.exp,not:ge,length:be,"!":ve,sign:Math.sign||je},this.binaryOps={"+":Dt,"-":Gt,"*":Jt,"/":Wt,"%":Xt,"^":Math.pow,"||":Yt,"==":Qt,"!=":Zt,">":te,"<":ee,">=":ne,"<=":re,and:oe,or:se,in:ie,"=":Oe,"[":Me},this.ternaryOps={"?":ke},this.functions={random:me,fac:ve,min:Se,max:Ce,hypot:Math.hypot||Ee,pyt:Math.hypot||Ee,pow:Math.pow,atan2:Math.atan2,if:ke,gamma:xe,roundTo:Ae,map:Te,fold:$e,filter:Re,indexOf:Ie,join:Fe},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}qe.prototype.parse=function(t){var e=[],n=new zt(this,new qt(this,t),{allowMemberAccess:this.options.allowMemberAccess});return n.parseExpression(e),n.expect($t,"EOF"),new Tt(e,this)},qe.prototype.evaluate=function(t,e){return this.parse(t).evaluate(e)};var Ve=new qe;qe.parse=function(t){return Ve.parse(t)},qe.evaluate=function(t,e){return Ve.parse(t).evaluate(e)};var ze={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};qe.prototype.isOperatorEnabled=function(t){var e=function(t){return ze.hasOwnProperty(t)?ze[t]:t}(t),n=this.options.operators||{};return!(e in n)||!!n[e]};
/*!
     Based on ndef.parser, by Raphael Graf(r@undefined.ch)
     http://www.undefined.ch/mparser/index.html

     Ported to JavaScript and modified by Matthew Crumley (email@matthewcrumley.com, http://silentmatt.com/)

     You are free to use and modify this code in anyway you find useful. Please leave this comment in the code
     to acknowledge its original source. If you feel like it, I enjoy hearing about projects that use my code,
     but don't feel like you have to let me know or ask permission.
    */
var Ue={Parser:qe,Expression:Tt};function He(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}var Ke=He(Object.freeze({__proto__:null,default:Ue,Expression:Tt,Parser:qe}));function De(t){return null!=t&&"object"==typeof t&&!0===t["@@functional/placeholder"]}function Ge(t){return function e(n){return 0===arguments.length||De(n)?e:t.apply(this,arguments)}}function Je(t){return function e(n,r){switch(arguments.length){case 0:return e;case 1:return De(n)?e:Ge((function(e){return t(n,e)}));default:return De(n)&&De(r)?e:De(n)?Ge((function(e){return t(e,r)})):De(r)?Ge((function(e){return t(n,e)})):t(n,r)}}}function We(t,e){switch(t){case 0:return function(){return e.apply(this,arguments)};case 1:return function(t){return e.apply(this,arguments)};case 2:return function(t,n){return e.apply(this,arguments)};case 3:return function(t,n,r){return e.apply(this,arguments)};case 4:return function(t,n,r,o){return e.apply(this,arguments)};case 5:return function(t,n,r,o,s){return e.apply(this,arguments)};case 6:return function(t,n,r,o,s,i){return e.apply(this,arguments)};case 7:return function(t,n,r,o,s,i,a){return e.apply(this,arguments)};case 8:return function(t,n,r,o,s,i,a,u){return e.apply(this,arguments)};case 9:return function(t,n,r,o,s,i,a,u,l){return e.apply(this,arguments)};case 10:return function(t,n,r,o,s,i,a,u,l,c){return e.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function Xe(t,e,n){return function(){for(var r=[],o=0,s=t,i=0;i<e.length||o<arguments.length;){var a;i<e.length&&(!De(e[i])||o>=arguments.length)?a=e[i]:(a=arguments[o],o+=1),r[i]=a,De(a)||(s-=1),i+=1}return s<=0?n.apply(this,r):We(s,Xe(t,r,n))}}var Ye=Je((function(t,e){return 1===t?Ge(e):We(t,Xe(t,[],e))}));function Qe(t){return function e(n,r,o){switch(arguments.length){case 0:return e;case 1:return De(n)?e:Je((function(e,r){return t(n,e,r)}));case 2:return De(n)&&De(r)?e:De(n)?Je((function(e,n){return t(e,r,n)})):De(r)?Je((function(e,r){return t(n,e,r)})):Ge((function(e){return t(n,r,e)}));default:return De(n)&&De(r)&&De(o)?e:De(n)&&De(r)?Je((function(e,n){return t(e,n,o)})):De(n)&&De(o)?Je((function(e,n){return t(e,r,n)})):De(r)&&De(o)?Je((function(e,r){return t(n,e,r)})):De(n)?Ge((function(e){return t(e,r,o)})):De(r)?Ge((function(e){return t(n,e,o)})):De(o)?Ge((function(e){return t(n,r,e)})):t(n,r,o)}}}var Ze=Array.isArray||function(t){return null!=t&&t.length>=0&&"[object Array]"===Object.prototype.toString.call(t)};function tn(t){return null!=t&&"function"==typeof t["@@transducer/step"]}function en(t,e,n){return function(){if(0===arguments.length)return n();var r=Array.prototype.slice.call(arguments,0),o=r.pop();if(!Ze(o)){for(var s=0;s<t.length;){if("function"==typeof o[t[s]])return o[t[s]].apply(o,r);s+=1}if(tn(o)){var i=e.apply(null,r);return i(o)}}return n.apply(this,arguments)}}var nn=function(){return this.xf["@@transducer/init"]()},rn=function(t){return this.xf["@@transducer/result"](t)};function on(t){return"[object String]"===Object.prototype.toString.call(t)}var sn=Ge((function(t){return!!Ze(t)||!!t&&("object"==typeof t&&(!on(t)&&(1===t.nodeType?!!t.length:0===t.length||t.length>0&&(t.hasOwnProperty(0)&&t.hasOwnProperty(t.length-1)))))})),an=function(){function t(t){this.f=t}return t.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},t.prototype["@@transducer/result"]=function(t){return t},t.prototype["@@transducer/step"]=function(t,e){return this.f(t,e)},t}();var un=Je((function(t,e){return We(t.length,(function(){return t.apply(e,arguments)}))})),ln=un;function cn(t,e,n){for(var r=n.next();!r.done;){if((e=t["@@transducer/step"](e,r.value))&&e["@@transducer/reduced"]){e=e["@@transducer/value"];break}r=n.next()}return t["@@transducer/result"](e)}function pn(t,e,n,r){return t["@@transducer/result"](n[r](ln(t["@@transducer/step"],t),e))}var hn="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function fn(t,e,n){if("function"==typeof t&&(t=function(t){return new an(t)}(t)),sn(n))return function(t,e,n){for(var r=0,o=n.length;r<o;){if((e=t["@@transducer/step"](e,n[r]))&&e["@@transducer/reduced"]){e=e["@@transducer/value"];break}r+=1}return t["@@transducer/result"](e)}(t,e,n);if("function"==typeof n["fantasy-land/reduce"])return pn(t,e,n,"fantasy-land/reduce");if(null!=n[hn])return cn(t,e,n[hn]());if("function"==typeof n.next)return cn(t,e,n);if("function"==typeof n.reduce)return pn(t,e,n,"reduce");throw new TypeError("reduce: list must be array or iterable")}var dn=function(){function t(t,e){this.xf=e,this.f=t}return t.prototype["@@transducer/init"]=nn,t.prototype["@@transducer/result"]=rn,t.prototype["@@transducer/step"]=function(t,e){return this.xf["@@transducer/step"](t,this.f(e))},t}(),gn=Je((function(t,e){return new dn(t,e)}));function yn(t,e){return Object.prototype.hasOwnProperty.call(e,t)}var mn=Object.prototype.toString,vn=function(){return"[object Arguments]"===mn.call(arguments)?function(t){return"[object Arguments]"===mn.call(t)}:function(t){return yn("callee",t)}}(),wn=vn,xn=!{toString:null}.propertyIsEnumerable("toString"),bn=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],En=function(){return arguments.propertyIsEnumerable("length")}(),kn=function(t,e){for(var n=0;n<t.length;){if(t[n]===e)return!0;n+=1}return!1},An="function"!=typeof Object.keys||En?Ge((function(t){if(Object(t)!==t)return[];var e,n,r=[],o=En&&wn(t);for(e in t)!yn(e,t)||o&&"length"===e||(r[r.length]=e);if(xn)for(n=bn.length-1;n>=0;)yn(e=bn[n],t)&&!kn(r,e)&&(r[r.length]=e),n-=1;return r})):Ge((function(t){return Object(t)!==t?[]:Object.keys(t)})),On=An,Mn=Je(en(["fantasy-land/map","map"],gn,(function(t,e){switch(Object.prototype.toString.call(e)){case"[object Function]":return Ye(e.length,(function(){return t.call(this,e.apply(this,arguments))}));case"[object Object]":return fn((function(n,r){return n[r]=t(e[r]),n}),{},On(e));default:return function(t,e){for(var n=0,r=e.length,o=Array(r);n<r;)o[n]=t(e[n]),n+=1;return o}(t,e)}}))),Cn=Mn,Sn=Number.isInteger||function(t){return t<<0===t},Tn=Je((function(t,e){var n=t<0?e.length+t:t;return on(e)?e.charAt(n):e[n]})),$n=Je((function(t,e){return t.map((function(t){for(var n,r=e,o=0;o<t.length;){if(null==r)return;n=t[o],r=Sn(n)?Tn(n,r):r[n],o+=1}return r}))})),Rn=Je((function(t,e){return $n([t],e)[0]})),In=Je((function(t,e){return Rn([t],e)})),Fn=Qe((function(t,e,n){var r={};for(var o in n)r[o]=n[o];return r[t]=e,r})),jn=Fn,Nn=Ge((function(t){return null==t})),_n=Qe((function t(e,n,r){if(0===e.length)return n;var o=e[0];if(e.length>1){var s=!Nn(r)&&yn(o,r)?r[o]:Sn(e[1])?[]:{};n=t(Array.prototype.slice.call(e,1),n,s)}if(Sn(o)&&Ze(r)){var i=[].concat(r);return i[o]=n,i}return jn(o,n,r)})),Pn=_n;var Ln=Ge((function(t){return null===t?"Null":void 0===t?"Undefined":Object.prototype.toString.call(t).slice(8,-1)}));function Bn(t,e,n,r){var o,s=function(o){for(var s=e.length,i=0;i<s;){if(t===e[i])return n[i];i+=1}for(var a in e[i+1]=t,n[i+1]=o,t)o[a]=r?Bn(t[a],e,n,!0):t[a];return o};switch(Ln(t)){case"Object":return s({});case"Array":return s([]);case"Date":return new Date(t.valueOf());case"RegExp":return o=t,new RegExp(o.source,(o.global?"g":"")+(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.sticky?"y":"")+(o.unicode?"u":""));default:return t}}var qn=Ge((function(t){return null!=t&&"function"==typeof t.clone?t.clone():Bn(t,[],[],!0)}));function Vn(t,e){return function(){var n=arguments.length;if(0===n)return e();var r=arguments[n-1];return Ze(r)||"function"!=typeof r[t]?e.apply(this,arguments):r[t].apply(r,Array.prototype.slice.call(arguments,0,n-1))}}var zn=Qe(Vn("slice",(function(t,e,n){return Array.prototype.slice.call(n,t,e)}))),Un=function(){function t(t,e){this.xf=e,this.n=t,this.i=0}return t.prototype["@@transducer/init"]=nn,t.prototype["@@transducer/result"]=rn,t.prototype["@@transducer/step"]=function(t,e){this.i+=1;var n,r=0===this.n?t:this.xf["@@transducer/step"](t,e);return this.n>=0&&this.i>=this.n?(n=r)&&n["@@transducer/reduced"]?n:{"@@transducer/value":n,"@@transducer/reduced":!0}:r},t}(),Hn=Je(en(["take"],Je((function(t,e){return new Un(t,e)})),(function(t,e){return zn(0,t<0?1/0:t,e)})));function Kn(t,e){return Hn(t<e.length?e.length-t:0,e)}var Dn=function(){function t(t,e){this.xf=e,this.pos=0,this.full=!1,this.acc=new Array(t)}return t.prototype["@@transducer/init"]=nn,t.prototype["@@transducer/result"]=function(t){return this.acc=null,this.xf["@@transducer/result"](t)},t.prototype["@@transducer/step"]=function(t,e){return this.full&&(t=this.xf["@@transducer/step"](t,this.acc[this.pos])),this.store(e),t},t.prototype.store=function(t){this.acc[this.pos]=t,this.pos+=1,this.pos===this.acc.length&&(this.pos=0,this.full=!0)},t}(),Gn=Je(en([],Je((function(t,e){return new Dn(t,e)})),Kn)),Jn=Je((function(t,e){return function(n){return function(r){return Cn((function(t){return e(t,r)}),n(t(r)))}}})),Wn=Ge((function(t){return Jn(Rn(t),Pn(t))})),Xn=Ge((function(t){return Jn(In(t),jn(t))})),Yn=function(t){return{value:t,"fantasy-land/map":function(){return this}}},Qn=Je((function(t,e){return t(Yn)(e).value})),Zn=Qn;const tr=["done","not done"];Xn("startFrameId");const er=Xn("frames");Xn("name");const nr=Object.freeze({single:"single",multiple:"multiple",diagnostic:"diagnostic",newTabAnswer:"newTabAnswer",answer:"answer",endConversation:"endConversation"});function rr(t="",e={}){for(const n of(t=>Object.values(Zn(er,t)))(e))for(const e of n.slots)if(e.name===t)return e;return null}Xn("name");Xn("replies");const or=new(0,Ke.Parser);function sr(t,e,n=null){return(r,o)=>{if(!r||Array.isArray(r))throw new cr("The first argument in a trigger formula must be a question name.");if(n&&!rr(r,n))throw new cr(`The question name "${r}" does not exist. Possibly a typo?\n       Correct typo or add ${r} to a tag so the trigger can evaluate it.`);if(!o||0==o.length)throw new cr(`Trigger formulas must have one or more indexes as the second argument\n        - check triggers that include ${r}`);const s=t[r];return!!s&&e(s,o)}}function ir(t,e){if(!Array.isArray(t)||!Array.isArray(e))throw new Error("hasSameMembers() called with non-array argument");const n=[...t].sort(),r=[...e].sort();return n.length===r.length&&n.every(((t,e)=>t===r[e]))}function ar(t,e){if(!Array.isArray(t)||!Array.isArray(e))throw new Error("isSubSet() called with non-array argument");return t.every((t=>e.includes(t)))}function ur(t,e){if(!Array.isArray(t)||!Array.isArray(e))throw new Error("hasOneOrMoreSharedMember() called with non-array argument");for(let n of t)if(e.includes(n))return!0;return!1}function lr(t="",e=null){return e?view(((t,e)=>Wn(["replies",t,e]))(t,e),bot):view(Wn(["replies",t]),bot)}function cr(t){this.name="Trigger Missing Or Invalid",this.message=t,this.exampleHTMLStr="Example:<br>\n    slot.trigger: same('TOSAccepted', [0])<br><br>",this.stack=(new Error).stack}cr.prototype=new Error;const pr=Object.freeze({completed:"completed",invalidReply:"invalidReply",abandoned:"abandoned",chatAgent:"chatAgent",callAgent:"callAgent"});function hr(t,e,n){if(void 0===t||void 0===e||void 0===n)return console.log(`initConversation(): an argument is undefined: \n      bot:${t}\ncurrentFrame:${e}\nlocalStorageKey:${n}`),null;const r=(({frames:t=[],currentFrame:e="",replies:n={},botCosmetics:r={}})=>({currentFrame:e,localeString:t[e].localeString,introduction:t[e].introduction,unSpokenFrames:qn(t),completedRounds:[],allReplyOptions:qn(n),botCosmetics:r}))({frames:t.frames,currentFrame:e,replies:t.replies,botCosmetics:t.botCosmetics});return et(r,n),r}function fr(t){const e=tt(t),n=e.unSpokenFrames[e.currentFrame].slots,r=function(t){let e={};return t.forEach((t=>{e[t.slot.name]=t.userReplyIndexes})),e}(e.completedRounds);or.functions.same=sr(r,ir),or.functions.subset=sr(r,ar),or.functions.share=sr(r,ur),or.functions.reply=sr(r,lr);const o=function(t,e){return t.find((t=>{try{return""===t.trigger||void 0===t.trigger||"true"===t.trigger||function(t,e){if(!t)throw new cr("Trigger argument must not be empty.");if(0===Object.keys(e).length)throw new cr("Adding a trigger to the first slot is unnecessary since the first slot will always execute.");try{const n=or.evaluate(t,e);if("boolean"==typeof n)return n;throw new cr(`Triggers must evaluate to true or false.  \n                                  "${t}" did not.`)}catch(e){throw console.log(e),new cr(`${e} in "${t}"`)}}(t.trigger,e)}catch(t){if("triggerMissingOrInvalidError"===t.name)return console.log(t),!1;throw t}}))}(n,r);if(void 0===o)return{completedRounds:qn(e.completedRounds),replyType:nr.endConversation,replyOptions:null};if(0===e.completedRounds.length||e.completedRounds.length>0&&o.name!==e.completedRounds[e.completedRounds.length-1].slot.name){const n=(({slot:t={},frameId:e="",userReplyValues:n=[],userReplyIndexes:r=[],ending:o="",stats:s={}})=>({slot:t,frameId:e,userReplyValues:n,userReplyIndexes:r,ending:o,stats:s}))({slot:qn(o),frameId:e.currentFrame});e.completedRounds.push(n),et(e,t)}return{completedRounds:qn(e.completedRounds),replyType:qn(o.type),replyOptions:qn(e.allReplyOptions[o.replyId])}}function dr(t,e){const n=t.unSpokenFrames[t.currentFrame].slots.findIndex((t=>t.name===e.slot.name));t.unSpokenFrames[t.currentFrame].slots.splice(n,1)}function gr({userReplyValues:t,userReplyIndexes:e,ending:n,stats:r,localStorageKey:o}){const s=tt(o),i=s.completedRounds[s.completedRounds.length-1];i.userReplyValues=t,i.userReplyIndexes=e,i.ending=n,i.stats=r,dr(s,i),et(s,o)}function yr(t){const e=e=>{!t||t.contains(e.target)||e.defaultPrevented||t.dispatchEvent(new CustomEvent("click_outside",t))};return document.addEventListener("click",e,!0),{destroy(){document.removeEventListener("click",e,!0)}}}function mr(t,e,n){const r=t.slice();return r[14]=e[n],r}function vr(t,e,n){const r=t.slice();return r[17]=e[n],r[18]=e,r[19]=n,r}function wr(t){let e,n=t[3],r=[];for(let e=0;e<n.length;e+=1)r[e]=br(vr(t,n,e));return{c(){e=p("ul");for(let t=0;t<r.length;t+=1)r[t].c();y(e,"class","mb-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm"),y(e,"tabindex","-1"),y(e,"role","listbox"),y(e,"aria-labelledby","listbox-label"),y(e,"aria-activedescendant","listbox-option-3")},m(t,n){u(t,e,n);for(let t=0;t<r.length;t+=1)r[t].m(e,null)},p(t,o){if(24&o){let s;for(n=t[3],s=0;s<n.length;s+=1){const i=vr(t,n,s);r[s]?r[s].p(i,o):(r[s]=br(i),r[s].c(),r[s].m(e,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(t){t&&l(e),c(r,t)}}}function xr(t){let e,n;return{c(){e=h("svg"),n=h("path"),y(n,"fill-rule","evenodd"),y(n,"d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"),y(n,"clip-rule","evenodd"),y(e,"class","h-5 w-5"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 20 20"),y(e,"fill","currentColor"),y(e,"aria-hidden","true")},m(t,r){u(t,e,r),a(e,n)},d(t){t&&l(e)}}}function br(t){let e,n,r,s,i,c,h,v,w=t[17].value+"",b=t[17].selected&&xr();function E(){return t[8](t[17],t[18],t[19])}function k(){return t[9](t[17],t[18],t[19])}function A(){return t[10](t[19])}return{c(){e=p("li"),n=p("span"),r=f(w),s=d(),i=p("span"),b&&b.c(),c=d(),y(n,"class","font-normal block truncate"),x(n,"font-semibold",t[17].selected),y(i,"class","text-gray-600 absolute inset-y-0 left-0 flex items-center pl-1.5"),x(i,"text-white",!0===t[17].highlighted),y(e,"class","text-gray-900 cursor-default select-none relative py-2 pl-8 pr-4 svelte-n5we1s"),y(e,"id","listbox-option-0"),y(e,"role","option"),x(e,"highlightedOption",!0===t[17].highlighted)},m(t,o){u(t,e,o),a(e,n),a(n,r),a(e,s),a(e,i),b&&b.m(i,null),a(e,c),h||(v=[g(e,"mouseenter",E),g(e,"mouseleave",k),g(e,"click",A)],h=!0)},p(o,s){t=o,8&s&&w!==(w=t[17].value+"")&&m(r,w),8&s&&x(n,"font-semibold",t[17].selected),t[17].selected?b||(b=xr(),b.c(),b.m(i,null)):b&&(b.d(1),b=null),8&s&&x(i,"text-white",!0===t[17].highlighted),8&s&&x(e,"highlightedOption",!0===t[17].highlighted)},d(t){t&&l(e),b&&b.d(),h=!1,o(v)}}}function Er(t){let e,n,r,o,s,i,c,h,v=t[1][t[14]]+"";function w(){return t[11](t[14])}return{c(){e=p("li"),n=p("span"),r=f(v),o=d(),s=p("span"),s.innerHTML='<svg class="fill-current h-6 w-6 " role="button" viewBox="0 0 20 20"><path d="M14.348,14.849c-0.469,0.469-1.229,0.469-1.697,0L10,11.819l-2.651,3.029c-0.469,0.469-1.229,0.469-1.697,0\n                                           c-0.469-0.469-0.469-1.229,0-1.697l2.758-3.15L5.651,6.849c-0.469-0.469-0.469-1.228,0-1.697s1.228-0.469,1.697,0L10,8.183\n                                           l2.651-3.031c0.469-0.469,1.228-0.469,1.697,0s0.469,1.229,0,1.697l-2.758,3.152l2.758,3.15\n                                           C14.817,13.62,14.817,14.38,14.348,14.849z"></path></svg>',i=d(),y(n,"class","font-normal block truncate"),y(s,"class","text-gray-600 absolute inset-y-0 left-0 flex items-center pl-1.5"),y(e,"class","text-gray-900 cursor-default block select-none relative py-1 pl-8 pr-4"),y(e,"id","listbox-option-0"),y(e,"role","option")},m(t,l){u(t,e,l),a(e,n),a(n,r),a(e,o),a(e,s),a(e,i),c||(h=g(s,"click",w),c=!0)},p(e,n){t=e,3&n&&v!==(v=t[1][t[14]]+"")&&m(r,v)},d(t){t&&l(e),c=!1,h()}}}function kr(t){let e;return{c(){e=p("div"),e.textContent="Select one or more options",y(e,"class","flex-1 text-gray-800 h-full w-full p-1 px-2 pl-3")},m(t,n){u(t,e,n)},d(t){t&&l(e)}}}function Ar(t){let e;return{c(){e=p("span"),e.innerHTML='<svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>',y(e,"class","absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none")},m(t,n){u(t,e,n)},d(t){t&&l(e)}}}function Or(t){let n,r,o;return{c(){n=p("button"),n.textContent="Done",y(n,"class","mt-3 w-full inline-flex items-center justify-center px-4 py-2 border border-transparent shadow-sm font-medium rounded-md text-white bg-primary-color hover:bg-hover-color focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-color")},m(e,s){u(e,n,s),r||(o=g(n,"click",t[6]),r=!0)},p:e,d(t){t&&l(n),r=!1,o()}}}function Mr(t){let n,r,i,h,f,m,v,w,x,b=t[2]&&wr(t),E=t[0],k=[];for(let e=0;e<E.length;e+=1)k[e]=Er(mr(t,E,e));let A=0===t[0].length&&kr(),O=!t[2]&&0===t[0].length&&Ar(),M=0!==t[0].length&&Or(t);return{c(){n=p("div"),b&&b.c(),r=d(),i=p("button"),h=p("ul");for(let t=0;t<k.length;t+=1)k[t].c();f=d(),A&&A.c(),m=d(),O&&O.c(),v=d(),M&&M.c(),y(h,"class","bg-white max-h-60 py-0 text-base overflow-auto focus:outline-none sm:text-sm"),y(h,"tabindex","-1"),y(h,"role","listbox"),y(h,"aria-labelledby","listbox-label"),y(h,"aria-activedescendant","listbox-option-3"),y(i,"type","button"),y(i,"class","w-full bg-white border border-gray-300 rounded-md shadow-sm pr-10 py-2 text-left cursor-default focus:outline-none focus:ring-1 focus:ring-primary-color focus:border-gray-500 sm:text-sm"),y(i,"aria-haspopup","listbox"),y(i,"aria-expanded","true"),y(i,"aria-labelledby","listbox-label"),y(n,"class","mt-1 relative sm:max-w-xs flex flex-col")},m(o,l){u(o,n,l),b&&b.m(n,null),a(n,r),a(n,i),a(i,h);for(let t=0;t<k.length;t+=1)k[t].m(h,null);var c;a(i,f),A&&A.m(i,null),a(i,m),O&&O.m(i,null),a(n,v),M&&M.m(n,null),w||(x=[g(i,"click",t[12]),(c=yr.call(null,n),c&&s(c.destroy)?c.destroy:e),g(n,"click_outside",t[7])],w=!0)},p(t,[e]){if(t[2]?b?b.p(t,e):(b=wr(t),b.c(),b.m(n,r)):b&&(b.d(1),b=null),35&e){let n;for(E=t[0],n=0;n<E.length;n+=1){const r=mr(t,E,n);k[n]?k[n].p(r,e):(k[n]=Er(r),k[n].c(),k[n].m(h,null))}for(;n<k.length;n+=1)k[n].d(1);k.length=E.length}0===t[0].length?A||(A=kr(),A.c(),A.m(i,m)):A&&(A.d(1),A=null),t[2]||0!==t[0].length?O&&(O.d(1),O=null):O||(O=Ar(),O.c(),O.m(i,null)),0!==t[0].length?M?M.p(t,e):(M=Or(t),M.c(),M.m(n,null)):M&&(M.d(1),M=null)},i:e,o:e,d(t){t&&l(n),b&&b.d(),c(k,t),A&&A.d(),O&&O.d(),M&&M.d(),w=!1,o(x)}}}function Cr(t,e,n){const r=A();let{selectedReplyIndexes:o=[]}=e,{replyOptions:s}=e,i=!1;const a=s.map(((t,e)=>({value:t,selected:!1})));function u(t){a[t].selected?l(t):(o.push(t),n(0,o),n(3,a[t].selected=!0,a),n(3,a))}function l(t){o.splice(o.indexOf(t),1),n(0,o),n(3,a[t].selected=!1,a),n(3,a),console.log(`removed ${t}`),console.log(o.length)}return t.$$set=t=>{"selectedReplyIndexes"in t&&n(0,o=t.selectedReplyIndexes),"replyOptions"in t&&n(1,s=t.replyOptions)},[o,s,i,a,u,l,function(){r("message",o)},function(t){n(2,i=!1)},(t,e,r)=>n(3,e[r].highlighted=!0,a),(t,e,r)=>n(3,e[r].highlighted=!1,a),t=>u(t),t=>l(t),()=>n(2,i=!i)]}class Sr extends G{constructor(t){super(),D(this,t,Cr,Mr,i,{selectedReplyIndexes:0,replyOptions:1})}}function Tr(t,e,n){const r=t.slice();return r[39]=e[n],r[41]=n,r}function $r(t,e,n){const r=t.slice();return r[39]=e[n],r[41]=n,r}function Rr(t,e,n){const r=t.slice();return r[43]=e[n].slot,r[44]=e[n].userReplyValues,r[46]=n,r}function Ir(t){let n;return{c(){n=p("h2"),n.textContent="Unknown error"},m(t,e){u(t,n,e)},p:e,i:e,o:e,d(t){t&&l(n)}}}function Fr(t){let n;return{c(){n=p("button"),n.innerHTML='<svg class="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24"></svg>\n    Loading',y(n,"type","button"),y(n,"class","bg-primary-600"),n.disabled=!0},m(t,e){u(t,n,e)},p:e,i:e,o:e,d(t){t&&l(n)}}}function jr(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Nr(t){let n,r,o;return{c(){n=p("h2"),r=f("Bot failed to load: "),o=f(t[9]),y(n,"class","text-gray text-lg")},m(t,e){u(t,n,e),a(n,r),a(n,o)},p(t,e){512&e[0]&&m(o,t[9])},i:e,o:e,d(t){t&&l(n)}}}function _r(t){let e,n,r,o,s,i,h,f,g,m,v,w,x,b,E,k=t[13](t[8])+"",A=t[13](t[1][t[1].length-1].slot.ask)+"",O=t[1].slice(0,-1),M=[];for(let e=0;e<O.length;e+=1)M[e]=Lr(Rr(t,O,e));const C=[Hr,Ur,zr,Vr,qr,Br],S=[];function T(t,e){return t[4]===nr.diagnostic||t[4]===nr.single&&t[2][0]===tr[0]?0:t[4]===nr.single?1:t[4]===nr.multiple?2:"freeTextEntry"===t[4]?3:t[4]===nr.endConversation?4:"answer"!==t[4]?5:-1}~(w=T(t))&&(x=S[w]=C[w](t));let $=t[14]&&function(t){let e,n,r;return{c(){e=p("hr"),n=d(),r=p("div"),y(e,"class","mt-4")},m(t,o){u(t,e,o),u(t,n,o),u(t,r,o)},d(t){t&&l(e),t&&l(n),t&&l(r)}}}();return{c(){e=p("div"),n=p("div"),r=p("div"),o=d();for(let t=0;t<M.length;t+=1)M[t].c();s=d(),i=p("div"),h=p("div"),f=p("p"),g=d(),m=p("div"),v=p("div"),x&&x.c(),b=d(),$&&$.c(),y(r,"id","frameIntroduction"),y(n,"id","conversationHistory"),y(n,"class","flex flex-col space-y-4 mb-4"),y(f,"class","text-l"),y(h,"id","currentAsk"),y(h,"class","mr-4 sm:mr-12"),y(v,"id","user-reply-div"),y(v,"class","sm:ml-6 mt-2"),y(m,"id","currentUserReply"),y(i,"id","currentRound"),y(i,"class","sm:space-y-5 bg-white border-solid border border-gray-200 rounded-lg p-3"),y(e,"id","botContainer"),y(e,"class","container mx-auto border bg-container-color rounded p-2 sm:p-6 w-auto max-w-xl")},m(t,l){u(t,e,l),a(e,n),a(n,r),r.innerHTML=k,a(n,o);for(let t=0;t<M.length;t+=1)M[t].m(n,null);a(e,s),a(e,i),a(i,h),a(h,f),f.innerHTML=A,a(i,g),a(i,m),a(m,v),~w&&S[w].m(v,null),a(e,b),$&&$.m(e,null),E=!0},p(t,e){if((!E||256&e[0])&&k!==(k=t[13](t[8])+"")&&(r.innerHTML=k),139266&e[0]){let r;for(O=t[1].slice(0,-1),r=0;r<O.length;r+=1){const o=Rr(t,O,r);M[r]?M[r].p(o,e):(M[r]=Lr(o),M[r].c(),M[r].m(n,null))}for(;r<M.length;r+=1)M[r].d(1);M.length=O.length}(!E||2&e[0])&&A!==(A=t[13](t[1][t[1].length-1].slot.ask)+"")&&(f.innerHTML=A);let o=w;w=T(t),w===o?~w&&S[w].p(t,e):(x&&(q(),U(S[o],1,1,(()=>{S[o]=null})),V()),~w?(x=S[w],x?x.p(t,e):(x=S[w]=C[w](t),x.c()),z(x,1),x.m(v,null)):x=null)},i(t){E||(z(x),E=!0)},o(t){U(x),E=!1},d(t){t&&l(e),c(M,t),~w&&S[w].d(),$&&$.d()}}}function Pr(t){let e,n,r,o,s,i,c,v,w=t[44].join(", ")+"";function x(){return t[25](t[46])}return{c(){e=p("div"),n=p("p"),r=f(w),o=d(),s=h("svg"),i=h("path"),y(i,"d","M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"),y(s,"xmlns","http://www.w3.org/2000/svg"),y(s,"class","inline-block ml-3 h-5 w-5 text-gray-400 hover:text-gray-800"),y(s,"viewBox","0 0 20 20"),y(s,"fill","currentColor"),y(n,"class","mx-4 border-b-2 border-gray-300 text-base inline-block hover:text-gray-800"),y(e,"id","user-reply-buttons-completed"),y(e,"class","mt-2")},m(t,l){u(t,e,l),a(e,n),a(n,r),a(n,o),a(n,s),a(s,i),c||(v=g(n,"click",x),c=!0)},p(e,n){t=e,2&n[0]&&w!==(w=t[44].join(", ")+"")&&m(r,w)},d(t){t&&l(e),c=!1,v()}}}function Lr(t){let e,n,r,o,s=t[13](t[43].ask)+"",i=t[44].length>0&&Pr(t);return{c(){e=p("div"),n=p("p"),r=d(),i&&i.c(),o=d(),y(n,"id","bot-ask-text-completed"),y(n,"class","text-l mr-4 sm:mr-12 "),y(e,"class","flex flex-col text-gray-400 bg-white border-solid border border-gray-200 rounded-lg p-3")},m(t,l){u(t,e,l),a(e,n),n.innerHTML=s,a(e,r),i&&i.m(e,null),a(e,o)},p(t,r){2&r[0]&&s!==(s=t[13](t[43].ask)+"")&&(n.innerHTML=s),t[44].length>0?i?i.p(t,r):(i=Pr(t),i.c(),i.m(e,o)):i&&(i.d(1),i=null)},d(t){t&&l(e),i&&i.d()}}}function Br(t){let n,r,o,s;return{c(){n=p("p"),r=f("Error: unsupported reply type of "),o=f(t[4]),s=f(" received"),y(n,"class","my-2")},m(t,e){u(t,n,e),a(n,r),a(n,o),a(n,s)},p(t,e){16&e[0]&&m(o,t[4])},i:e,o:e,d(t){t&&l(n)}}}function qr(t){let n;return{c(){n=p("p"),n.textContent="End of conversation",y(n,"class","my-2")},m(t,e){u(t,n,e)},p:e,i:e,o:e,d(t){t&&l(n)}}}function Vr(t){let n,r,s,i,c,h,w,x,b,E,k;return{c(){n=p("div"),r=p("input"),s=d(),i=p("button"),i.textContent="Go",c=d(),h=p("span"),h.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path></svg>',w=d(),x=p("p"),b=f(t[7]),y(r,"type","text"),y(r,"size","50"),y(h,"class","askIcon"),y(n,"class","my-2")},m(e,o){u(e,n,o),a(n,r),v(r,t[6]),a(n,s),a(n,i),a(n,c),a(n,h),a(n,w),a(n,x),a(x,b),E||(k=[g(r,"input",t[29]),g(r,"keyup",t[30]),g(i,"click",t[19]),g(h,"click",t[31])],E=!0)},p(t,e){64&e[0]&&r.value!==t[6]&&v(r,t[6]),128&e[0]&&m(b,t[7])},i:e,o:e,d(t){t&&l(n),E=!1,o(k)}}}function zr(t){let e,n;return e=new Sr({props:{replyOptions:t[2]}}),e.$on("message",t[16]),{c(){var t;(t=e.$$.fragment)&&t.c()},m(t,r){H(e,t,r),n=!0},p(t,n){const r={};4&n[0]&&(r.replyOptions=t[2]),e.$set(r)},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){U(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function Ur(t){let n,r,s,i,h,f,m,v=t[2],x=[];for(let e=0;e<v.length;e+=1)x[e]=Kr(Tr(t,v,e));return{c(){n=p("div"),r=p("div"),s=p("select");for(let t=0;t<x.length;t+=1)x[t].c();i=d(),h=p("button"),h.textContent="Done",y(s,"class","block w-full pl-2 pr-10 text-base font-medium border-gray-300 focus:outline-none focus:ring-primary-color sm:text-sm rounded-md"),void 0===t[5]&&F((()=>t[27].call(s))),y(r,"class","w-full sm:max-w-xs"),y(h,"type","button"),y(h,"class","mt-3 w-full inline-flex items-center justify-center px-4 py-2 border border-transparent font-medium rounded-md sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm shadow-sm text-white bg-primary-color hover:bg-hover-color focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-hover-color"),y(n,"class","sm:flex sm:items-center")},m(e,o){u(e,n,o),a(n,r),a(r,s);for(let t=0;t<x.length;t+=1)x[t].m(s,null);w(s,t[5]),a(n,i),a(n,h),f||(m=[g(s,"change",t[27]),g(h,"click",t[28])],f=!0)},p(t,e){if(4&e[0]){let n;for(v=t[2],n=0;n<v.length;n+=1){const r=Tr(t,v,n);x[n]?x[n].p(r,e):(x[n]=Kr(r),x[n].c(),x[n].m(s,null))}for(;n<x.length;n+=1)x[n].d(1);x.length=v.length}32&e[0]&&w(s,t[5])},i:e,o:e,d(t){t&&l(n),c(x,t),f=!1,o(m)}}}function Hr(t){let n,r,o=t[18](t[2]),s=[];for(let e=0;e<o.length;e+=1)s[e]=Dr($r(t,o,e));return{c(){n=p("div"),r=p("div");for(let t=0;t<s.length;t+=1)s[t].c();y(r,"class","w-full sm:max-w-xs"),y(n,"class","sm:flex sm:items-center")},m(t,e){u(t,n,e),a(n,r);for(let t=0;t<s.length;t+=1)s[t].m(r,null)},p(t,e){if(294916&e[0]){let n;for(o=t[18](t[2]),n=0;n<o.length;n+=1){const i=$r(t,o,n);s[n]?s[n].p(i,e):(s[n]=Dr(i),s[n].c(),s[n].m(r,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=o.length}},i:e,o:e,d(t){t&&l(n),c(s,t)}}}function Kr(t){let e,n,r,o=t[39]+"";return{c(){e=p("option"),n=f(o),e.__value=r=t[41],e.value=e.__value},m(t,r){u(t,e,r),a(e,n)},p(t,e){4&e[0]&&o!==(o=t[39]+"")&&m(n,o)},d(t){t&&l(e)}}}function Dr(t){let e,n,r,o,s,i,c=t[39]+"";function h(){return t[26](t[39],t[41])}return{c(){e=p("button"),n=f(c),r=d(),y(e,"type","button"),y(e,"class","w-full inline-flex items-center justify-center px-4 py-2 border border-transparent font-medium rounded-md sm:w-auto sm:text-sm shadow-sm text-white bg-primary-color hover:bg-hover-color focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-hover-color"),y(e,"id",o="reply-"+t[41])},m(t,o){u(t,e,o),a(e,n),a(e,r),s||(i=g(e,"click",h),s=!0)},p(e,r){t=e,4&r[0]&&c!==(c=t[39]+"")&&m(n,c)},d(t){t&&l(e),s=!1,i()}}}function Gr(t){let e,n,r,o;const s=[_r,Nr,jr,Fr,Ir],i=[];function a(t,e){return t[10]&&!t[12]?0:t[12]?1:t[0]?2:t[11]?3:4}return e=a(t),n=i[e]=s[e](t),{c(){n.c(),r=f("")},m(t,n){i[e].m(t,n),u(t,r,n),o=!0},p(t,o){let u=e;e=a(t),e===u?i[e].p(t,o):(q(),U(i[u],1,1,(()=>{i[u]=null})),V(),n=i[e],n?n.p(t,o):(n=i[e]=s[e](t),n.c()),z(n,1),n.m(r.parentNode,r))},i(t){o||(z(n),o=!0)},o(t){U(n),o=!1},d(t){i[e].d(t),t&&l(r)}}}function Jr(t={}){const e=document.getElementById("botContainer");e.style.setProperty("--primary-color",t.primaryColor),e.style.setProperty("--secondary-color",t.secondaryColor),e.style.setProperty("--hover-color",t.hoverColor),e.style.setProperty("--container-color",t.containerBg),e.style.setProperty("--container-border-color",t.containerBorderBg),e.style.fontFamily=t.customerFont}function Wr(t,e,n){let{propBotConfig:r=null}=e,{propGetConfigFromRemote:o=!1}=e,{localStorageKey:s}=e,{waitForStartNewConversation:i=!1}=e;const a=require("marked");let u,l,c,p,h,f,d="",g="",y="",m="",v=!i,w=!1,x=!1,b=!!r,E=null;function A(t,e,r,o){return t&&Y(t.version)?(function(t,e){let n=JSON.stringify(t);localStorage.setItem(e,n)}(t,r),E=t.startFrameId,t):(o||n(11,w=!0),t=W(!1,e,r,o),n(11,w=!1),t?(E=t.startFrameId,t):null)}function O(t){if(t){let e=tt(s)||hr(t,E,s);return e?(n(8,y=e.introduction),u=e.localeString,C(),n(10,v=!0),e):(console.log("failed to load conversation in loadConversation()"),n(10,v=!1),null)}console.log("Error calling loadConversation(): botConfig arg must be supplied")}var M;function C(){n(6,d=""),n(7,g=""),n(1,({completedRounds:l,replyType:h,replyOptions:c}=fr(s)),l,n(4,h),n(2,c))}function S(t,e){gr({userReplyValues:[t],userReplyIndexes:[e],ending:pr.completed,stats:{},localStorageKey:s}),C()}function T(t){!function(t,e,n){if(void 0===t||void 0===e||void 0===n)return console.log(`rewindConversation(): an argument is undefined: \n      rewoundRoundIndex:${t}\ngetConfigFromRemote:${e}\nlocalStorageKey:${n}`),null;const r=tt(n);r.completedRounds=r.completedRounds.slice(0,t);const o=W(!1,e,n,!1);r.unSpokenFrames=qn(o.frames),r.completedRounds.forEach((t=>{dr(r,t)})),et(r,n)}(t,!1,s),C()}function $(){try{parseTextInput(d)}catch(t){n(7,g=t),console.log(t.stack)}}function R(t){"Enter"===t.key&&$()}!async function(t,e,r,o){try{const s=A(t,r,e,o);if(s){let t=O(s);n(10,v=!0),await I(),Jr(t.botCosmetics)}else if(!o)throw new X("getBotConfig() failed to acquire a botConfig from localStorage\n          and remote and waitForStartNewConversation prop was false")}catch(t){console.log(`botconfig load error: ${t}`),n(9,m=t),n(12,x=!0)}}(r,s,o,i),M=()=>{!function(){const t=document.querySelectorAll("#conversationHistory ul > li img:first-child, \n                    #currentAsk ul > li img:first-child");t.length>0&&(t.forEach((t=>t.style.marginTop="3rem")),t.forEach((t=>{t.parentElement.parentElement.style.listStyleType="none"})))}()},k().$$.after_update.push(M);return t.$$set=t=>{"propBotConfig"in t&&n(21,r=t.propBotConfig),"propGetConfigFromRemote"in t&&n(22,o=t.propGetConfigFromRemote),"localStorageKey"in t&&n(23,s=t.localStorageKey),"waitForStartNewConversation"in t&&n(0,i=t.waitForStartNewConversation)},[i,l,c,p,h,f,d,g,y,m,v,w,x,a,b,S,function(t){gr({userReplyValues:t.detail.map((t=>c[t])),userReplyIndexes:t.detail,ending:pr.completed,stats:{},localStorageKey:s}),C()},T,function(t){return t[0]===tr[0]&&(t=Gn(1,t)),t},$,R,r,o,s,async function(t=null){try{let e=A(t||r,o,s,i);if(!e)throw new X("startNewConversation() failed to acquire a botConfig from localStorage and remote.");let a=hr(e,E,s);if(!a)throw new X("startNewConversation() failed to acquire conversation objectfrom initConversation()");u=a.localeString,n(8,y=a.introduction),C(),n(10,v=!0),await I(),Jr(a.botCosmetics)}catch(t){console.log(`startNewConversation() botconfig error: ${t}`),n(9,m=t),n(12,x=!0)}},t=>T(t),(t,e)=>S(t,e),function(){f=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(5,f)},()=>S(c[f],f),function(){d=this.value,n(6,d)},t=>R(t),()=>n(3,p=!0)]}return t.Bot=class extends G{constructor(t){super(),D(this,t,Wr,Gr,i,{propBotConfig:21,propGetConfigFromRemote:22,localStorageKey:23,waitForStartNewConversation:0,startNewConversation:24},null,[-1,-1])}get startNewConversation(){return this.$$.ctx[24]}},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
